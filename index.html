<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gears • Globe • Aurora</title>
  <style>
    html,body{height:100%;margin:0;background:#01020a;overflow:hidden;color:#ddd;font-family:system-ui,Segoe UI,Roboto,Arial}
    #container{position:relative;width:100vw;height:100vh}
    canvas, #three-root{position:absolute;left:0;top:0;width:100%;height:100%}
    .ui{position:absolute;left:16px;top:16px;z-index:40;background:rgba(0,0,0,0.35);backdrop-filter:blur(6px);padding:10px;border-radius:8px}
    .ui label{display:flex;align-items:center;gap:8px}
    #gears-wrap{position:absolute;left:16px;bottom:16px;z-index:30}
    svg.gear{filter:drop-shadow(0 6px 18px rgba(0,0,0,0.6))}
  </style>
</head>
<body>
<div id="container">
  <div id="three-root"></div>
  <canvas id="aurora"></canvas>

  <div class="ui">
    <div><strong>Gears • Globe • Aurora</strong></div>
    <label>Globe speed <input id="globeSpeed" type="range" min="0" max="2" step="0.01" value="0.35"></label>
    <label>Aurora intensity <input id="auroraInt" type="range" min="0" max="1.5" step="0.01" value="0.9"></label>
    <label>Gear speed <input id="gearSpeed" type="range" min="-2" max="2" step="0.01" value="0.5"></label>
  </div>

  <div id="gears-wrap"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script>
// ----- Three.js rotating globe -----
const root = document.getElementById('three-root');
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(40, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio || 1);
root.appendChild(renderer.domElement);
camera.position.z = 3.6;

function makeEarthTexture(){
  const c = document.createElement('canvas'); c.width=1024; c.height=512;
  const ctx = c.getContext('2d');
  ctx.fillStyle='#071233'; ctx.fillRect(0,0,c.width,c.height);
  ctx.fillStyle='#2a6b2f';
  for(let i=0;i<300;i++){
    const x=Math.random()*c.width, y=Math.random()*c.height, w=4+Math.random()*40, h=w*(0.3+Math.random()*1.8);
    ctx.beginPath(); ctx.ellipse(x,y,w,h,Math.random()*Math.PI,0,Math.PI*2); ctx.fill();
  }
  ctx.globalAlpha=0.08; ctx.fillStyle='#ffffff';
  for(let i=0;i<700;i++){ const x=Math.random()*c.width, y=Math.random()*c.height, r=1+Math.random()*4; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill(); }
  return new THREE.CanvasTexture(c);
}
const globe = new THREE.Mesh(new THREE.SphereGeometry(1.2, 64, 64),
  new THREE.MeshStandardMaterial({map: makeEarthTexture(), metalness:0.05, roughness:0.9}));
scene.add(globe);
scene.add(new THREE.AmbientLight(0xffffff, 0.55));
const dir = new THREE.DirectionalLight(0xffffff, 0.6); dir.position.set(5,3,5); scene.add(dir);

// starfield
const starGeo = new THREE.BufferGeometry();
const starCount = 4000; const starPos = new Float32Array(starCount*3);
for(let i=0;i<starCount;i++){ const r=30+Math.random()*100; const theta=Math.random()*Math.PI*2; const phi=(Math.random()*2-1)*Math.PI/2; starPos[i*3]=Math.cos(theta)*Math.cos(phi)*r; starPos[i*3+1]=Math.sin(phi)*r; starPos[i*3+2]=Math.sin(theta)*Math.cos(phi)*r; }
starGeo.setAttribute('position', new THREE.BufferAttribute(starPos,3));
scene.add(new THREE.Points(starGeo, new THREE.PointsMaterial({size:0.6, opacity:0.9})));

// ----- Aurora overlay -----
const auroraCanvas = document.getElementById('aurora');
const aCtx = auroraCanvas.getContext('2d');
function resizeAurora(){ auroraCanvas.width = window.innerWidth; auroraCanvas.height = window.innerHeight; }
resizeAurora();
window.addEventListener('resize', ()=>{camera.aspect=window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); resizeAurora();});

function auroraFrame(t, intensity=1.0){
  const w = auroraCanvas.width, h = auroraCanvas.height;
  aCtx.clearRect(0,0,w,h);
  aCtx.fillStyle = 'rgba(0,0,6,0.35)'; aCtx.fillRect(0,0,w,h);
  aCtx.globalCompositeOperation = 'lighter';
  for(let layer=0; layer<5; layer++){
    const base = (layer*0.7 + t*0.0003*(1+layer));
    const grad = aCtx.createLinearGradient(0,h*0.2,0,h*0.8);
    const hue = 140 + 40*Math.sin(layer+0.2*t*0.001);
    grad.addColorStop(0, `rgba(${Math.floor(hue+10)},180,220,${0.02*intensity})`);
    grad.addColorStop(0.5, `rgba(${Math.floor(hue+80)},230,200,${0.08*intensity})`);
    grad.addColorStop(1, `rgba(0,0,0,0)`);
    aCtx.fillStyle = grad;
    aCtx.beginPath();
    const amplitude = 80 + layer*30 + 30*Math.sin(base*0.7);
    aCtx.moveTo(0,h);
    for(let x=0;x<=w;x+=8){
      const nx = x/w*6;
      const y = h*0.2 + Math.sin(nx*1.5 + base*0.8)*amplitude + Math.sin(nx*3.2 + base*0.3)*20;
      aCtx.lineTo(x, y);
    }
    aCtx.lineTo(w,h); aCtx.closePath(); aCtx.fill();
  }
  aCtx.globalCompositeOperation = 'source-over';
}

// ----- SVG Gears -----
function gearPath(teeth, radius){
  const toothDepth = radius*0.12; const rOuter = radius + toothDepth; const rInner = radius - toothDepth*0.4;
  let d = ''; const steps = teeth*2;
  for(let i=0;i<steps;i++){ const angle = (i/steps)*Math.PI*2; const r=(i%2==0)?rOuter:rInner; const x=Math.cos(angle)*r, y=Math.sin(angle)*r; d += (i===0?`M ${x} ${y}`:` L ${x} ${y}`); }
  return d+' Z';
}
function makeGear(id, teeth, radius, color){
  const ns='http://www.w3.org/2000/svg'; const svg=document.createElementNS(ns,'svg');
  svg.setAttribute('width', radius*2+40); svg.setAttribute('height', radius*2+40);
  svg.setAttribute('viewBox', `${-radius-20} ${-radius-20} ${radius*2+40} ${radius*2+40}`);
  svg.classList.add('gear'); svg.dataset.teeth=teeth; svg.style.margin='6px';
  const path=document.createElementNS(ns,'path'); path.setAttribute('d',gearPath(teeth,radius)); path.setAttribute('fill',color); path.setAttribute('stroke','rgba(255,255,255,0.06)'); svg.appendChild(path);
  const hole=document.createElementNS(ns,'circle'); hole.setAttribute('r',Math.max(6,radius*0.2)); hole.setAttribute('fill','rgba(0,0,0,0.25)'); svg.appendChild(hole);
  document.getElementById('gears-wrap').appendChild(svg);
  return svg;
}
const gears=[makeGear('g1',40,60,'#c9a66b'), makeGear('g2',24,40,'#8fb0c8'), makeGear('g3',16,28,'#b08ea6')];

// ----- Animation -----
let last=performance.now(), globeSpeed=parseFloat(globeSpeed.value), auroraInt=parseFloat(auroraInt.value), gearSpeed=parseFloat(gearSpeed.value);
document.getElementById('globeSpeed').oninput=e=>globeSpeed=parseFloat(e.target.value);
document.getElementById('auroraInt').oninput=e=>auroraInt=parseFloat(e.target.value);
document.getElementById('gearSpeed').oninput=e=>gearSpeed=parseFloat(e.target.value);

function animate(now){
  const dt=(now-last)/1000; last=now;
  globe.rotation.y+=dt*globeSpeed*0.25;
  globe.rotation.x=Math.sin(now*0.0002)*0.02; globe.rotation.z=Math.sin(now*0.00013)*0.01;
  const base=gearSpeed*1.5; const t0=base*now*0.001; const teeth0=parseFloat(gears[0].dataset.teeth);
  gears.forEach((g,i)=>{let angle=t0*(teeth0/parseFloat(g.dataset.teeth)); if(i%2==1) angle=-angle; g.style.transform=`rotate(${angle}rad)`;});
  renderer.render(scene,camera);
  auroraFrame(now,auroraInt);
  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);
</script>
</body>
</html>
